<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery DApp</title>
    <script src="https://unpkg.com/@stacks/connect@latest/dist/connect.umd.js"></script>
    <script src="https://unpkg.com/@stacks/transactions@latest/dist/transactions.umd.js"></script>
    <script src="https://unpkg.com/@stacks/network@latest/dist/network.umd.js"></script>
</head>
<body>
    <h1>Lottery DApp</h1>

    <button id="connect-wallet">Connect Wallet</button>

    <h2>Create a New Round</h2>
    <form id="create-round-form">
        <label for="end-height">End Height:</label>
        <input type="number" id="end-height" name="end-height" required>
        <label for="token-contract">Token:</label>
        <select id="token-contract" name="token-contract" required>
            <option value="SP3NE50GEXFG9SZGTT51P40X2CKYSZ5CC4ZTZ7A2G.welshcorgicoin-token">Welshcorgicoin ($WELSH)</option>
            <option value="SP1AY6K3PQV5MRT6R4S671NWW2FRVPKM0BR162CT6.leo-token">LEO ($LEO)</option>
            <option value="SP1N4EXSR8DP5GRN2XCWZEW9PR32JHNRYW7MVPNTA.PomerenianBoo-Pomboo">Pomeranian Boo ($POMBOO)</option>
        </select>
        <button type="submit">Create Round</button>
    </form>

    <h2>Buy a Ticket</h2>
    <form id="buy-ticket-form">
        <label for="round-id">Round ID:</label>
        <input type="number" id="round-id" name="round-id" required>
        <button type="submit">Buy Ticket</button>
    </form>

    <h2>End a Round</h2>
    <form id="end-round-form">
        <label for="end-round-id">Round ID:</label>
        <input type="number" id="end-round-id" name="end-round-id" required>
        <button type="submit">End Round</button>
    </form>

    <script>
        const { StacksTestnet } = window.StacksNetwork;
        const { standardPrincipalCV, uintCV, principalCV, trueCV, makeContractCall, broadcastTransaction } = window.StacksTransactions;
        const { showConnect, UserSession, AppConfig } = window.StacksConnect;

        const appConfig = new AppConfig(['store_write', 'publish_data']);
        const userSession = new UserSession({ appConfig });

        const network = new StacksTestnet();

        document.getElementById('connect-wallet').onclick = function () {
            showConnect({
                appDetails: {
                    name: 'Lottery DApp',
                    icon: window.location.origin + '/path/to/your/icon.png', // Update the path to your app icon
                },
                userSession,
                onFinish: () => {
                    const userData = userSession.loadUserData();
                    alert('Wallet connected: ' + userData.profile.stxAddress.testnet);
                },
            });
        };

        async function submitTransaction(functionName, functionArgs) {
            const options = {
                contractAddress: 'SP3NE50GEXFG9SZGTT51P40X2CKYSZ5CC4ZTZ7A2G', // Replace with your contract address
                contractName: 'functions', // Replace with your contract name
                functionName,
                functionArgs,
                network,
                senderAddress: userSession.loadUserData().profile.stxAddress.testnet,
            };

            const transaction = await makeContractCall(options);
            const result = await broadcastTransaction(transaction, network);
            alert(`${functionName} executed: ${result.txid}`);
        }

        document.getElementById('create-round-form').onsubmit = function (event) {
            event.preventDefault();
            const endHeight = document.getElementById('end-height').value;
            const tokenContract = document.getElementById('token-contract').value;
            submitTransaction('create-round', [uintCV(parseInt(endHeight)), principalCV(tokenContract)]);
        };

        document.getElementById('buy-ticket-form').onsubmit = function (event) {
            event.preventDefault();
            const roundId = document.getElementById('round-id').value;
            submitTransaction('buy-ticket', [uintCV(parseInt(roundId))]);
        };

        document.getElementById('end-round-form').onsubmit = function (event) {
            event.preventDefault();
            const roundId = document.getElementById('end-round-id').value;
            submitTransaction('end-round', [uintCV(parseInt(roundId))]);
        };
    </script>
</body>
</html>
